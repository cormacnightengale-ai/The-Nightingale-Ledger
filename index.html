<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Nightingale Ledger: Shared Ledger System</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Fonts for the intimate, themed style -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Cormorant+Garamond:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        /* Base Goth/Intimate Styling */
        body {
            font-family: 'Cormorant Garamond', serif;
            background-color: #000000; /* True Black */
            min-height: 100vh;
            color: #e0e0e0; /* Faint Silver text */
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        h1, h2, h3 {
            font-family: 'Cinzel', serif;
        }
        .neon-title {
            text-shadow: 0 0 7px #b05c6c, 0 0 10px #b05c6c, 0 0 21px #b05c6c, 0 0 42px #b05c6c;
        }
        .text-error {
            color: #ff4d4d;
            font-weight: bold;
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #555;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #1a1a23;
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <!-- Main Content Area -->
    <div id="main-content" class="container mx-auto max-w-7xl hidden">
        <header class="text-center mb-12">
            <h1 class="text-4xl sm:text-6xl font-cinzel text-[#b05c6c] neon-title mb-4">The Nightingale Ledger</h1>
            <p class="text-lg text-gray-400 max-w-xl mx-auto">A shared accountability and reward system.</p>
        </header>

        <!-- Player Scores -->
        <section class="mb-12 p-6 bg-[#1a1a23] rounded-2xl shadow-2xl border border-[#3c3c45]">
            <h2 class="text-3xl font-cinzel text-gray-200 mb-6 text-center">Current Points</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 text-center">
                
                <!-- Keeper Points -->
                <div class="p-6 rounded-xl border border-[#5c4a4e] bg-[#24242e] shadow-xl">
                    <div id="keeper-name-display" class="group flex justify-center items-center">
                        <h3 id="keeper-name" class="text-4xl font-cinzel text-[#c9b4ba] cursor-pointer hover:text-white transition-colors" onclick="window.toggleNameEdit('keeper')">Keeper</h3>
                        <i class="fa-solid fa-pencil text-xs ml-2 text-gray-500 hover:text-white transition-colors cursor-pointer" onclick="window.toggleNameEdit('keeper')"></i>
                    </div>
                    <div id="keeper-name-edit" class="hidden flex justify-center items-center space-x-2">
                        <input id="keeper-new-name" type="text" class="bg-gray-700 text-white rounded p-2 text-center text-xl w-32" placeholder="New Name">
                        <button onclick="window.submitNewName('keeper')" class="bg-emerald-600 hover:bg-emerald-700 text-white p-2 rounded-lg text-sm"><i class="fa-solid fa-save"></i></button>
                    </div>
                    <p class="text-6xl font-bold text-yellow-400 mt-4"><span id="keeper-points">0</span> <i class="fa-solid fa-gem text-5xl ml-1"></i></p>
                </div>
                
                <!-- Nightingale Points -->
                <div class="p-6 rounded-xl border border-[#555a68] bg-[#24242e] shadow-xl">
                    <div id="nightingale-name-display" class="group flex justify-center items-center">
                        <h3 id="nightingale-name" class="text-4xl font-cinzel text-[#a0a8b9] cursor-pointer hover:text-white transition-colors" onclick="window.toggleNameEdit('nightingale')">Nightingale</h3>
                        <i class="fa-solid fa-pencil text-xs ml-2 text-gray-500 hover:text-white transition-colors cursor-pointer" onclick="window.toggleNameEdit('nightingale')"></i>
                    </div>
                    <div id="nightingale-name-edit" class="hidden flex justify-center items-center space-x-2">
                        <input id="nightingale-new-name" type="text" class="bg-gray-700 text-white rounded p-2 text-center text-xl w-32" placeholder="New Name">
                        <button onclick="window.submitNewName('nightingale')" class="bg-emerald-600 hover:bg-emerald-700 text-white p-2 rounded-lg text-sm"><i class="fa-solid fa-save"></i></button>
                    </div>
                    <p class="text-6xl font-bold text-yellow-400 mt-4"><span id="nightingale-points">0</span> <i class="fa-solid fa-gem text-5xl ml-1"></i></p>
                </div>
            </div>
        </section>

        <!-- Pending Actions -->
        <section id="pending-actions" class="mb-12 p-6 bg-[#1a1a23] rounded-2xl shadow-2xl border border-[#3c3c45]">
            <h2 class="text-3xl font-cinzel text-[#b05c6c] mb-6 text-center border-b border-[#3c3c45] pb-2">Pending Actions</h2>
            <div id="pending-rewards-section" class="mb-6 hidden">
                <h3 class="text-xl font-bold text-yellow-300 mb-3"><i class="fa-solid fa-hourglass-start mr-2"></i> Reward Requests</h3>
                <ul id="pending-rewards-list" class="space-y-2">
                    <!-- Pending rewards will be inserted here -->
                </ul>
            </div>
            <div id="pending-punishments-section" class="hidden">
                <h3 class="text-xl font-bold text-red-400 mb-3"><i class="fa-solid fa-exclamation-triangle mr-2"></i> Assigned Punishments</h3>
                <ul id="pending-punishments-list" class="space-y-2">
                    <!-- Pending punishments will be inserted here -->
                </ul>
            </div>
            <p id="pending-loading" class="text-center text-gray-500 italic">No pending rewards or punishments.</p>
        </section>

        <!-- Forms -->
        <section class="mb-12 space-y-4">
            <!-- Habit Form -->
            <div id="habit-form" class="hidden p-6 bg-[#2a2a36] rounded-xl shadow-inner border border-[#4c4c5c]">
                <h3 class="text-2xl font-cinzel text-gray-200 mb-4">Add New Habit</h3>
                <form>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <input id="new-habit-desc" type="text" placeholder="Habit Description (e.g., Water the plants)" required class="md:col-span-2 p-3 bg-gray-700 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-[#b05c6c] outline-none">
                        <input id="new-habit-points" type="number" placeholder="Points" min="1" required class="p-3 bg-gray-700 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-[#b05c6c] outline-none">
                        <select id="new-habit-player" required class="p-3 bg-gray-700 rounded-lg text-white focus:ring-2 focus:ring-[#b05c6c] outline-none">
                            <option value="keeper">Keeper's Habit</option>
                            <option value="nightingale">Nightingale's Habit</option>
                        </select>
                    </div>
                    <div class="flex justify-end space-x-3 mt-4">
                        <button type="button" onclick="window.fillHabitForm()" class="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-colors"><i class="fa-solid fa-shuffle mr-2"></i>Example</button>
                        <button type="submit" class="bg-[#b05c6c] hover:bg-[#c06c7c] text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-colors"><i class="fa-solid fa-plus mr-2"></i>Save Habit</button>
                        <button type="button" onclick="window.toggleHabitForm()" class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-colors">Cancel</button>
                    </div>
                </form>
            </div>

            <!-- Reward Form -->
            <div id="reward-form" class="hidden p-6 bg-[#2a2a36] rounded-xl shadow-inner border border-[#4c4c5c]">
                <h3 class="text-2xl font-cinzel text-gray-200 mb-4">Add New Reward</h3>
                <form>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <input id="new-reward-title" type="text" placeholder="Reward Title" required class="md:col-span-2 p-3 bg-gray-700 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-[#b05c6c] outline-none">
                        <input id="new-reward-cost" type="number" placeholder="Cost (Points)" min="1" required class="md:col-span-2 p-3 bg-gray-700 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-[#b05c6c] outline-none">
                    </div>
                    <textarea id="new-reward-desc" placeholder="Reward Description (e.g., 1 hour uninterrupted gaming)" required class="w-full mt-4 p-3 bg-gray-700 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-[#b05c6c] outline-none h-20"></textarea>
                    <div class="flex justify-end space-x-3 mt-4">
                        <button type="button" onclick="window.fillRewardForm()" class="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-colors"><i class="fa-solid fa-shuffle mr-2"></i>Example</button>
                        <button type="submit" class="bg-yellow-600 hover:bg-yellow-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-colors"><i class="fa-solid fa-plus mr-2"></i>Save Reward</button>
                        <button type="button" onclick="window.toggleRewardForm()" class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-colors">Cancel</button>
                    </div>
                </form>
            </div>

            <!-- Punishment Form -->
            <div id="punishment-form" class="hidden p-6 bg-[#2a2a36] rounded-xl shadow-inner border border-[#4c4c5c]">
                <h3 class="text-2xl font-cinzel text-gray-200 mb-4">Add New Punishment</h3>
                <form>
                    <input id="new-punishment-title" type="text" placeholder="Punishment Title" required class="w-full p-3 bg-gray-700 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-[#b05c6c] outline-none">
                    <textarea id="new-punishment-desc" placeholder="Punishment Description (e.g., Do the dishes immediately)" required class="w-full mt-4 p-3 bg-gray-700 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-[#b05c6c] outline-none h-20"></textarea>
                    <div class="flex justify-end space-x-3 mt-4">
                        <button type="button" onclick="window.fillPunishmentForm()" class="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-colors"><i class="fa-solid fa-shuffle mr-2"></i>Example</button>
                        <button type="submit" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-colors"><i class="fa-solid fa-plus mr-2"></i>Save Punishment</button>
                        <button type="button" onclick="window.togglePunishmentForm()" class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-colors">Cancel</button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Action Buttons -->
        <div class="flex flex-wrap justify-center gap-4 mb-12">
            <button onclick="window.toggleHabitForm()" class="bg-[#5c4a4e] hover:bg-[#6c5a5e] text-white font-bold py-3 px-6 rounded-xl shadow-lg transition-colors text-lg flex items-center"><i class="fa-solid fa-clipboard-list mr-3"></i> Add Habit</button>
            <button onclick="window.toggleRewardForm()" class="bg-[#b05c6c] hover:bg-[#c06c7c] text-white font-bold py-3 px-6 rounded-xl shadow-lg transition-colors text-lg flex items-center"><i class="fa-solid fa-sack-dollar mr-3"></i> Add Reward</button>
            <button onclick="window.togglePunishmentForm()" class="bg-[#555a68] hover:bg-[#656a78] text-white font-bold py-3 px-6 rounded-xl shadow-lg transition-colors text-lg flex items-center"><i class="fa-solid fa-hammer mr-3"></i> Add Punishment</button>
        </div>


        <!-- Main Sections: Habits, Rewards, Punishments, and History -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            
            <!-- 1. HABITS -->
            <section class="lg:col-span-1 p-6 bg-[#1a1a23] rounded-2xl shadow-2xl border border-[#3c3c45]">
                <h2 class="text-3xl font-cinzel text-gray-200 mb-6 border-b border-[#3c3c45] pb-2">Active Habits <i class="fa-solid fa-check-double"></i></h2>
                <ul id="habits-list" class="space-y-3 max-h-[60vh] overflow-y-auto pr-2 custom-scrollbar">
                    <!-- Habits will be inserted here -->
                </ul>
                <p id="habits-loading" class="text-center text-gray-500 italic mt-4">Define habits to start earning points.</p>
            </section>
            
            <!-- 2. REWARDS / PUNISHMENTS (Combined in the middle column for mobile) -->
            <div class="lg:col-span-1 space-y-8">
                <!-- REWARDS -->
                <section class="p-6 bg-[#1a1a23] rounded-2xl shadow-2xl border border-[#3c3c45]">
                    <h2 class="text-3xl font-cinzel text-yellow-400 mb-6 border-b border-[#3c3c45] pb-2">Rewards <i class="fa-solid fa-hand-holding-heart"></i></h2>
                    <ul id="rewards-list" class="space-y-3 max-h-[30vh] overflow-y-auto pr-2 custom-scrollbar">
                        <!-- Rewards will be inserted here -->
                    </ul>
                    <p id="rewards-loading" class="text-center text-gray-500 italic mt-4 hidden">No rewards defined yet.</p>
                </section>

                <!-- PUNISHMENTS -->
                <section class="p-6 bg-[#1a1a23] rounded-2xl shadow-2xl border border-[#3c3c45]">
                    <h2 class="text-3xl font-cinzel text-red-500 mb-6 border-b border-[#3c3c45] pb-2">Punishments <i class="fa-solid fa-skull-crossbones"></i></h2>
                    <ul id="punishments-list" class="space-y-3 max-h-[30vh] overflow-y-auto pr-2 custom-scrollbar">
                        <!-- Punishments will be inserted here -->
                    </ul>
                    <p id="punishments-loading" class="text-center text-gray-500 italic mt-4 hidden">No punishments defined yet.</p>
                </section>
            </div>
            
            <!-- 3. HISTORY -->
            <section class="lg:col-span-1 p-6 bg-[#1a1a23] rounded-2xl shadow-2xl border border-[#3c3c45]">
                <h2 class="text-3xl font-cinzel text-gray-200 mb-6 border-b border-[#3c3c45] pb-2">Ledger History <i class="fa-solid fa-book-open"></i></h2>
                <ul id="history-list" class="space-y-3 max-h-[60vh] overflow-y-auto pr-2 custom-scrollbar">
                    <!-- History items will be inserted here -->
                </ul>
                <p id="history-loading" class="text-center text-gray-500 italic mt-4">No activity yet. Approve a reward or assign a punishment to start the log!</p>
            </section>
        </div>
        
        <!-- Debug/Footer Info -->
        <footer class="mt-12 pt-6 border-t border-[#3c3c45] text-center text-xs text-gray-500">
            <p>User ID: <span id="current-user-id">...</span> | App ID: <span id="current-app-id">...</span></p>
        </footer>

    </div>

    <!-- Initial Loading/Error Screen -->
    <div id="loading-screen" class="min-h-screen flex flex-col items-center justify-center p-6 text-center">
        <h1 class="text-4xl sm:text-6xl font-cinzel text-[#b05c6c] mb-6 neon-title">The Nightingale Ledger</h1>
        <div class="text-lg text-gray-400 max-w-xl mx-auto space-y-4">
            <p>Attempting to connect to the shared ledger...</p>
            <p>
                If this screen persists, please ensure your environment is configured correctly.
            </p>
            <!-- New element for displaying non-critical auth/connection errors -->
            <p id="auth-error-message" class="text-error mt-4"></p>
        </div>
    </div>

    <!-- External JavaScript Imports -->
    <!-- 1. The data definitions must load first -->
    <script src="./examples.js"></script>
    <!-- 2. The firebase config must load next for global access -->
    <script src="./firebase_config.js"></script>
    <!-- 3. The main application script -->
    <script type="module" src="./script.js"></script>
</body>
</html>